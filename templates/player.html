{% extends "layout.html" %}
{% block content %}
<a class="btn" href="{{ url_for('channel_detail', channel_id=channel_id) }}">Back</a>
<h2>{{ stream.title or "Player" }}</h2>

<div class="video-wrap">
  <video id="video" controls autoplay playsinline></video>
  <div class="small" style="margin-top:10px;">
    If playback fails, it is usually CORS/hotlink protection on the stream host.
  </div>
  <details style="margin-top:10px;">
    <summary class="small">Show stream URL</summary>
    <pre>{{ stream.url }}</pre>
  </details>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
<script>
  const video = document.getElementById('video');
  const url = {{ stream.url|tojson }};

  if (video.canPlayType('application/vnd.apple.mpegurl')) {
    // Safari
    video.src = url;
  } else if (Hls.isSupported()) {
    const hls = new Hls({
      enableWorker: true,
      lowLatencyMode: false,
    });
    hls.loadSource(url);
    hls.attachMedia(video);

    hls.on(Hls.Events.ERROR, function (event, data) {
      console.log('HLS error', data);
      // You can display a nicer message here if you want
    });
  } else {
    video.outerHTML = "<p>Your browser does not support HLS playback.</p>";
  }
</script>
{% endblock %}
